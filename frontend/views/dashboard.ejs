<!DOCTYPE html>
<html lang="id">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Security Dashboard</title>
		<link
			href="https://fonts.googleapis.com/css?family=Poppins:400,500,600&display=swap"
			rel="stylesheet"
		/>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<link rel="stylesheet" href="/css/style.css" />
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>Security Assessment</h1>
				<div>
					<select id="dropdown-bahasa">
						<option value="en">English</option>
						<option value="id">Bahasa Indonesia</option>
					</select>
				</div>
			</div>

			<form id="scan-form" action="/test/scan-all" method="POST">
				<div class="card" style="margin-bottom: 20px">
					<div class="form-group">
						<label for="url">URL Target</label>
						<select
							name="url"
							id="url"
							required
							style="
								width: 100%;
								padding: 10px;
								border: 1px solid #d1d5db;
								border-radius: 6px;
								background: #fff;
								font-family: inherit;
							"
						>
							<option value="" disabled selected>
								-- Pilih Target Pengujian --
							</option>
							<optgroup label="Website utama">
								<option value="https://mhs.unsiq.ac.id/index.php">
									mhs.unsiq.ac.id (Portal Mahasiswa)
								</option>
								<option value="http://unsiq.ac.id">unsiq.ac.id</option>
								<option value="kerjasama.unsiq.ac.id">
									kerjasama.unsiq.ac.id
								</option>
							</optgroup>
							<optgroup label="Website fakultas">
								<option value="http://web.fastikom-unsiq.ac.id">
									fastikom-unsiq.ac.id
								</option>
								<option value="http://fitk.unsiq.ac.id/">
									fitk.unsiq.ac.id
								</option>
								<option value="http://fsh.unsiq.ac.id/">fsh.unsiq.ac.id</option>
								<option value="http://feb-unsiq.ac.id">feb-unsiq.ac.id</option>
								<option value="http://www.fksp.unsiq.ac.id">
									fksp.unsiq.ac.id
								</option>
								<option value="http://www.fbs.unsiq.ac.id">
									www.fbs.unsiq.ac.id
								</option>
								<option value="http://fikes.unsiq.ac.id">
									fikes.unsiq.ac.id
								</option>
							</optgroup>
							<optgroup label="test server">
								<option value="http://restuproduction.com">
									restuproduction.com (Server Test)
								</option>
								<option value="http://yogaar.my.id">
									yogaar.my.id (vuln target)
								</option>
								<option value="http://testphp.vulnweb.com">testphp.vulnweb.com (Acunetix vulnweb)</option>
							</optgroup>
						</select>
					</div>
					<div class="form-group">
						<label for="cookie_header">
							Session Cookie (Opsional - untuk scan area login)
						</label>
						<input
							type="text"
							name="cookie_header"
							id="cookie_header"
							placeholder="PHPSESSID=...; security=low"
						/>
					</div>
				</div>

				<div class="scan-grid">
					<div class="card">
						<div class="card-title">Vulnerability Assessment</div>
						<div class="checkbox-group">
							<label class="checkbox-item">
								<input
									type="checkbox"
									name="tests"
									value="tech"
									class="calc-time"
									checked
								/>
								<div>
									<strong>Tech & CVE Detection</strong>
									<div style="font-size: 0.8em; color: #666">
										Mendeteksi versi software web & database serta
										kerentanannya.
									</div>
								</div>
							</label>
						</div>
					</div>

					<div class="card">
						<div class="card-title">Injection Testing (Critical)</div>
						<div class="checkbox-group">
							<label class="checkbox-item">
								<input
									type="checkbox"
									name="tests"
									value="xss_sqli"
									class="calc-time"
									checked
								/>
								<div>
									<strong>Input Injection (XSS & SQLi)</strong>
									<div style="font-size: 0.8em; color: #666">
										Menguji form dan parameter URL terhadap serangan injeksi.
									</div>
								</div>
							</label>
						</div>
					</div>

					<div class="card">
						<div class="card-title">Server Misconfiguration</div>
						<div class="checkbox-group">
							<label class="checkbox-item">
								<input
									type="checkbox"
									name="tests"
									value="zap"
									class="calc-time"
								/>
								HTTP Headers (ZAP)
							</label>
							<small>Menguji konfigurasi header server</small>

							<label class="checkbox-item">
								<input
									type="checkbox"
									name="tests"
									value="ssl"
									class="calc-time"
								/>
								SSL/TLS Security (SSLyze)
							</label>
							<small>Menguji Konfigurasi SSL/TLS pada server</small>

							<label class="checkbox-item">
								<input
									type="checkbox"
									name="tests"
									value="nmap"
									id="enable-nmap"
									class="calc-time"
								/>
								Port Scanning (Nmap)
							</label>
							<small>
								Pemindaian jaringan yang digunakan untuk menemukan perangkat dan
								layanan dalam suatu jaringan serta mendeteksi potensi
								kerentanannya
							</small>

							<div id="nmap-options" class="sub-options">
								<label style="font-weight: 600; font-size: 0.8em">
									Target Ports:
								</label>
								<div class="radio-group">
									<label>
										<input
											type="radio"
											name="nmap_ports"
											value="top100"
											class="calc-time"
										/>
										Top 100
									</label>
									<label>
										<input
											type="radio"
											name="nmap_ports"
											value="top1000"
											class="calc-time"
											checked
										/>
										Top 1000
									</label>
									<label>
										<input
											type="radio"
											name="nmap_ports"
											value="all"
											class="calc-time"
										/>
										All Ports
									</label>
									<label>
										<input
											type="radio"
											name="nmap_ports"
											value="specific"
											class="calc-time"
										/>
										Specific
									</label>
								</div>
								<div style="margin-top: 8px">
									<label class="checkbox-item">
										<input
											type="checkbox"
											name="nmap_show_service"
											value="sV"
											class="calc-time"
											checked
										/>
										Deteksi layanan (-sV)
									</label>
								</div>
							</div>
						</div>
					</div>

					<div class="card">
						<div class="card-title">Resilience & Rate Limiting</div>
						<div class="checkbox-group">
							<label class="checkbox-item">
								<input
									type="checkbox"
									name="tests"
									value="ratelimit"
									id="enable-ratelimit"
									class="calc-time"
								/>
								<strong>Rate Limit / Bot Protection Test</strong>
								<small>
									Menguji apakah server dapat membedakan koneksi asli dan bot
								</small>
							</label>

							<div id="ratelimit-options" class="sub-options">
								<label style="font-weight: 600; font-size: 0.8em">
									Level Pengujian:
								</label>
								<select
									name="ratelimit_level"
									id="ratelimit-level"
									class="calc-time"
									style="width: 100%; margin-top: 5px"
								>
									<option value="1">
										Level 1: 50 Request (akurasi rendah)
									</option>
									<option value="2">
										Level 2: 250 Request (direkomendasikan)
									</option>
									<option value="3">Level 3: 1000 request</option>
								</select>
							</div>
						</div>
					</div>
				</div>
				<div style="margin-top: 20px">
					<label class="checkbox-item">
						<input type="checkbox" id="select-all" class="calc-time" />
						<strong>Pilih Semua Pengujian</strong>
					</label>
				</div>

				<div
					style="
						margin-top: 20px;
						padding: 10px;
						background: #e0f2fe;
						border: 1px solid #bae6fd;
						color: #0369a1;
						border-radius: 8px;
						text-align: center;
						font-weight: 600;
					"
				>
					Estimasi Waktu Pengujian:
					<span id="estimated-time">0 detik</span>
					<br />
					<small>
						Pengujian dapat lebih cepat atau lebih lambat tergantung kecepatan
						internet yanganda gunakan dan kondisi server target
					</small>
				</div>

				<div style="margin-top: 15px">
					<button type="submit" class="btn-submit" id="btn-start-scan">
						Mulai Analisis Keamanan
					</button>
				</div>
			</form>

			<div id="progress-container">
				<div id="progress-bar">0%</div>
			</div>
			<div id="progress-status"></div>

			<!-- AREA HASIL SCAN -->
			<div id="scan-result"></div>

			<!-- STATIK CANVAS DIHAPUS UNTUK MENGHINDARI KONFLIK ID -->
		</div>

		<div id="translate-overlay">
			<div style="font-size: 1.5rem; margin-top: 15px; font-weight: bold">
				Menerjemahkan Laporan...
			</div>
			<br />
			<div style="margin-top: 5px">Mohon tunggu sebentar</div>
		</div>

		<script src="/js/dashboard.js"></script>
		<script>
			// Toggle Display
			const nmapCheck = document.getElementById("enable-nmap")
			if (nmapCheck)
				nmapCheck.addEventListener("change", function () {
					document.getElementById("nmap-options").style.display = this.checked
						? "block"
						: "none"
				})

			const rlCheck = document.getElementById("enable-ratelimit")
			if (rlCheck)
				rlCheck.addEventListener("change", function () {
					document.getElementById("ratelimit-options").style.display = this
						.checked
						? "block"
						: "none"
				})

			// Kalkulator Waktu (Error Proof)
			function calculateTime() {
				let totalSeconds = 0

				// Helper aman untuk cek checkbox
				const isChecked = (sel) => {
					const el = document.querySelector(sel)
					return el ? el.checked : false
				}

				if (isChecked('input[name="tests"][value="tech"]')) totalSeconds += 45
				if (isChecked('input[name="tests"][value="xss_sqli"]'))
					totalSeconds += 30
				if (isChecked('input[name="tests"][value="zap"]')) totalSeconds += 120
				if (isChecked('input[name="tests"][value="ssl"]')) totalSeconds += 20

				if (isChecked('input[name="tests"][value="nmap"]')) {
					const portEl = document.querySelector(
						'input[name="nmap_ports"]:checked',
						'input[name="nmap_show_service"]:checked',
					)
					const portOpt = portEl ? portEl.value : "top1000"

					if (portOpt === "all") totalSeconds += 450
					else if (portOpt === "specific") totalSeconds += 60
					else totalSeconds += 45
				}

				if (isChecked('input[name="tests"][value="ratelimit"]')) {
					const levelEl = document.getElementById("ratelimit-level")
					const level = levelEl ? levelEl.value : "1"

					if (level == "1") totalSeconds += 6
					else if (level == "2") totalSeconds += 25
					else if (level == "3") totalSeconds += 45
				}

				let timeText =
					totalSeconds >= 60
						? `${Math.floor(totalSeconds / 60)} menit ${
								totalSeconds % 60
						  } detik`
						: `${totalSeconds} detik`

				const output = document.getElementById("estimated-time")
				if (output) output.innerText = `~ ${timeText}`
			}

			document
				.querySelectorAll(".calc-time")
				.forEach((el) => el.addEventListener("change", calculateTime))
			// Initial Run
			calculateTime()
		</script>
	</body>
</html>
